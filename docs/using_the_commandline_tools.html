<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
    <head>
        <title>Zoph Documentation - Using_the_commandline_tools</title>
        <link TYPE="text/css" REL="stylesheet" HREF="style.css">
    </head>
    <body>
    <p>
    All text is available under the terms of the <a href="http://en.wikibooks.org/wiki/GNU_Free_Documentation_License">GNU Free Documentation License</a>. For the latest version of this document, see <a href="http://en.wikibooks.org/wiki/Zoph">Wikibooks</a>.
    </p>
		<h1 class="firstHeading">Zoph/Using the commandline tools</h1>
		<div id="bodyContent">
			<table id="toc" class="toc" summary="Contents">
<tr>
<td>
<div id="toctitle">
<h2>Contents</h2>
</div>
<ul>
<li class="toclevel-1"><a href="#ZophImport.pl"><span class="tocnumber">1</span> <span class="toctext">ZophImport.pl</span></a>
<ul>
<li class="toclevel-2"><a href="#Loading_Images"><span class="tocnumber">1.1</span> <span class="toctext">Loading Images</span></a></li>
<li class="toclevel-2"><a href="#Minimal_Examples"><span class="tocnumber">1.2</span> <span class="toctext">Minimal Examples</span></a></li>
<li class="toclevel-2"><a href="#Detailed_Example"><span class="tocnumber">1.3</span> <span class="toctext">Detailed Example</span></a></li>
<li class="toclevel-2"><a href="#Broken_Images"><span class="tocnumber">1.4</span> <span class="toctext">Broken Images</span></a></li>
<li class="toclevel-2"><a href="#Command_Line_Options"><span class="tocnumber">1.5</span> <span class="toctext">Command Line Options</span></a></li>
<li class="toclevel-2"><a href="#EXIF_Fields"><span class="tocnumber">1.6</span> <span class="toctext">EXIF Fields</span></a></li>
<li class="toclevel-2"><a href="#Further_Examples"><span class="tocnumber">1.7</span> <span class="toctext">Further Examples</span></a></li>
<li class="toclevel-2"><a href="#Reducing_Thumbnail_Size"><span class="tocnumber">1.8</span> <span class="toctext">Reducing Thumbnail Size</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#ZophExport.pl"><span class="tocnumber">2</span> <span class="toctext">ZophExport.pl</span></a>
<ul>
<li class="toclevel-2"><a href="#A_Quick_Example"><span class="tocnumber">2.1</span> <span class="toctext">A Quick Example</span></a></li>
<li class="toclevel-2"><a href="#Selecting_Photos"><span class="tocnumber">2.2</span> <span class="toctext">Selecting Photos</span></a></li>
<li class="toclevel-2"><a href="#Choosing_What_to_Display"><span class="tocnumber">2.3</span> <span class="toctext">Choosing What to Display</span></a></li>
<li class="toclevel-2"><a href="#A_Simple_Export"><span class="tocnumber">2.4</span> <span class="toctext">A Simple Export</span></a></li>
<li class="toclevel-2"><a href="#Exporting_to_Album"><span class="tocnumber">2.5</span> <span class="toctext">Exporting to Album</span></a></li>
<li class="toclevel-2"><a href="#Exporting_to_BINS"><span class="tocnumber">2.6</span> <span class="toctext">Exporting to BINS</span></a></li>
</ul>
</li>
</ul>
</td>
</tr>
</table>
<script type="text/javascript">
//<![CDATA[
 if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } 
//]]>
</script>
<p><a name="ZophImport.pl" id="ZophImport.pl"></a></p>
<h2> <span class="mw-headline">ZophImport.pl</span></h2>
<p><a name="Loading_Images" id="Loading_Images"></a></p>
<h3> <span class="mw-headline">Loading Images</span></h3>
<p>This section describes the command line Perl importer. The next one talks about the web based importer.</p>
<p>First get some images to load. Zoph was created to manage photos taken by digital cameras (which contain info in their exif headers) but you could use anything.</p>
<p>You should have defined an IMAGE_DIR variable in config.inc.php during installation. For this example, I have the image service disabled and my IMAGE_DIR set to a photos directory in my home directory. I have created a symbolic link from zoph/photos (off the web server's doc root) to this directory:</p>
<pre>
&gt; ln -s $HOME/photos /var/www/zoph/photos
</pre>
<p>You can organize your photos under this directory in any way you choose. I'll provide examples of two possible systems. Read over these minimal examples before actually loading your photos.</p>
<p><a name="Minimal_Examples" id="Minimal_Examples"></a></p>
<h3> <span class="mw-headline">Minimal Examples</span></h3>
<p>Within my images directory I separate things by camera and by date. I have a Kodak DC280 so I created a dc280 directory:</p>
<pre>
&gt; pwd
/home/jgeiger/photos
&gt; ls
dc280
</pre>
<p>Here is one way to import photos. I store photos to be imported in an incoming directory in my home directory.</p>
<pre>
&gt; ls ~/incoming
DCP_0155.JPG
&gt; zophImport.pl --path dc280 --datedDirs ~/incoming/*.JPG
</pre>
<p>The --path flag tells the importer I want the photos to be put in the dc280 directory. The --datedDirs flag means that the photo should be put in a subdirectory based on the date field found in the photos Exif header. After running the script:</p>
<pre>
&gt; ls dc280
2002.03.14
&gt; ls dc280/2002.03.14
DCP_0155.JPG mid thumb
</pre>
<p>The mid/ and thumb/ directories hold images scaled down to 120 and 480 pixels respectively. If you wonder why zophImport.pl takes so long to import photos it is because it is creating these two smaller images (using ImageMagick's convert utility).</p>
<p>What if you don't want to use dated directories to store your images? Here is an alternative way:</p>
<pre>
&gt; pwd
/home/jgeiger/photos
&gt; mkdir christmas_2001
&gt; zophImport.pl --path christmas_2001 ~/incoming/*.JPG
&gt; ls christmas_2001
DCP_0155.JPG mid thumb
</pre>
<p>The same result could have been accomplished by:</p>
<pre>
&gt; mkdir christmas_2001
&gt; mv ~/incoming/*.JPG christmas_2001/
&gt; zophImport.pl christmas_2001/*.JPG
</pre>
<p>By not specifying a path, the importer uses the path that the photos are currently in.</p>
<p>Whatever way you import photos, make sure you run the script from within your photos directory (as specified by IMAGE_DIR). The importer needs to be able to correctly extract the relative path to the photos from here to be stored in the database.</p>
<p><a name="Detailed_Example" id="Detailed_Example"></a></p>
<h3> <span class="mw-headline">Detailed Example</span></h3>
<p>It is best to set as much information about photos during import so you don't have to do it one photo at a time within Zoph. I often have a directory of images to import that were all taken at the same time which makes this easy to do.</p>
<p>Here is what I used to load the images I took for this tutorial:</p>
<pre>
&gt; pwd
/home/jgeiger/photos
&gt; zophImport.pl --path dc280 --datedDirs --photographer "Jason Geiger" --location "Jason's Apartment" --album "Zoph Tutorial" ~/incoming/*.JPG
</pre>
<p>To use the --photographer, --location and --album parameters, corresponding records must have been previously created in Zoph. So first create a person/place/album/category using the web interface, then import using them.</p>
<p>What if you made a mistake, or remembered a piece of information you want to add? Pass the --update parameter so that the photos will not be inserted again:</p>
<pre>
&gt; zophImport.pl --update --field rating=5 --field description="This is part of the zoph tutorial" dc280/2002.03.14/*.JPG
</pre>
<p>This will set the rating and description for all the photos I just imported. To set any of the fields found in the photos table (such as rating, title, description, etc), use the --field NAME=VALUE flag.</p>
<p>For more info and examples about the importer, see the section at the end of this document.</p>
<p><a name="Broken_Images" id="Broken_Images"></a></p>
<h3> <span class="mw-headline">Broken Images</span></h3>
<p>It is not uncommon to make a mistake while loading images so that when you view the ui you see a bunch of broken images. This most likely due to an invalid path. To check, edit one of the images in Zoph and click on "show additional attributes" at the bottom. Then you should be able to see the path info. It should always be the case that WEB_IMAGE_PATH (or IMAGE_PATH) + the photo's path field + the photo's name reflects the photo's location.</p>
<p>You can use the importer to correct the paths for broken images:</p>
<pre>
&gt; zophImport.pl --update --path 'dc280/2002.03.14' dc280/2002.03.14/*.JPG
</pre>
<p>If you still see broken images, check the permissions on the files and directories.</p>
<p><a name="Command_Line_Options" id="Command_Line_Options"></a></p>
<h3> <span class="mw-headline">Command Line Options</span></h3>
<p>Here is a list of all the fields that can be set when importing:</p>
<ul>
<li>--datedDirs (put photos in YYYY.MM.DD dirs)</li>
<li>--hierarchical (put photos in hierarchical dated dirs (YYYY/MM/DD) (&gt;v0.5) you need to also specify the --datedDirs argument, otherwise this will not work.</li>
<li>--update (update existing photos)</li>
<li>--updateSize (update the photo's width, height and size. implies --update.)</li>
<li>--updateExif (reparse and load the exif headers. implied --update.)</li>
<li>--useIds (use photo_ids not file names to identify photos for update)</li>
<li>--noThumbnails (do not generate thumbnails)</li>
<li>--album ALBUM</li>
<li>--category CATEGORY</li>
<li>--photographer "FIRST_NAME LAST_NAME"</li>
<li>--location PLACE_TITLE</li>
<li>--people "FIRST_NAME LAST_NAME, FIRST_NAME LAST_NAME"</li>
<li>--path PATH (relative to IMAGE_DIR)</li>
<li>--field NAME=VALUE (use to set title, view, description, rating, level, etc)</li>
<li>--verbose (give more information about what's going on) (&gt;v0.5)</li>
<li>--copy (copy instead of move photos) (&gt;v0.5)</li>
<li>--resolveSymlinks (resolve symlinks before importing) (&gt;=0.7)</li>
</ul>
<p>Photos can appear in multiple albums and categories, and multiple people can be in a photo. To handle this, you can either pass a comma separated list or set the flag multiple times. Actually, you can use a comma separated list for categories and people but not for albums (since I realized that I have many albums with commas in their names and have yet to build an escape mechanism).</p>
<p><a name="EXIF_Fields" id="EXIF_Fields"></a></p>
<h3> <span class="mw-headline">EXIF Fields</span></h3>
<p>The following fields will be set automatically if they can be extracted from the EXIF header. They can also be set manually, using the --field NAME=VALUE flag, if you wish. This is by no means an exhaustive list of possible EXIF headers but these are the ones that have been set by the cameras I have used or that have been reported to me. The resolution and size fields are ignored, this info being instead extracted by Image::Size in the importer.</p>
<ul>
<li>date</li>
<li>time</li>
<li>camera_make</li>
<li>camera_model</li>
<li>flash_used</li>
<li>focal_length</li>
<li>exposure (Exposure and Exposure time headers)</li>
<li>compression (Jpeg process and JPG Quality headers)</li>
<li>aperture</li>
<li>iso_equiv</li>
<li>metering_mode</li>
<li>ccd_width</li>
<li>focus_dist</li>
<li>comment</li>
</ul>
<p><a name="Further_Examples" id="Further_Examples"></a></p>
<h3> <span class="mw-headline">Further Examples</span></h3>
<p>Below are a couple more examples.</p>
<p>Adding a list of people to a photo (if there are many people it is often faster to do this using the importer rather than through the web ui):</p>
<pre>
&gt; zophImport.pl --update --people "Jason Geiger, Virginia Wolfe" dc280/2002.03.14/DCP_0155.JPG
</pre>
<p>People should be listed left to right, front to back. These people must already be the database. If one of the names could not be found the importer will complain.</p>
<p>Updating all the photos in a directory:</p>
<pre>
&gt; find dc280/ -iname "*.jpg" -maxdepth 2 | xargs zophImport.pl --updateSize
</pre>
<p>You may want to use the --updateSize option like above if you had rotated or resized a bunch of images and wanted to get the correct dimensions into zoph. Specifying a maxdepth prevents the thumbnails from being included.</p>
<p>Starting in version 0.3 of the importer you can also update photos based on their photo_ids rather than names. Say you notice couple sequences of of your photos have an incorrect location. You can see the photo_id for a photos in the url and it may be simpler to update based on that rather than by passing the file names:</p>
<pre>
&gt; zophImport.pl --update --useIds --location "Yuka's House" 1562-1571 1580-1585
</pre>
<p>As of version 0.7, you can influence the way zophImport.pl handles symbolic links.</p>
<p>For example, you have the following files IMG_0001.JPG, IMG_0002.JPG, both taken 01-01-2007 and LNK_0002.JPG, which is a symlink to IMG_0002.JPG.</p>
<p>If you would import these files with</p>
<pre>
zophImport.pl --datedDirs IMG_0001.JPG LNK_0002.JPG
</pre>
<p>You would have two files in 2007.01.01: IMG_0001.JPG and LNK_0002.JPG - both will be "normal" files. You will also have IMG_0002.JPG, still in it's old location.</p>
<p>If you would import these files with</p>
<pre>
zophImport.pl --datedDirs --resolveSymlinks IMG_0001.JPG LNK_0002.JPG
</pre>
<p>You would have two files in 2007.01.01: IMG_0001.JPG and IMG_0002.JPG - both will be "normal" files. You will also have IMG_0002.JPG, still in it's old location.</p>
<p><a name="Reducing_Thumbnail_Size" id="Reducing_Thumbnail_Size"></a></p>
<h3> <span class="mw-headline">Reducing Thumbnail Size</span></h3>
<p>Based on a suggestion from Alan Shutko, in version 0.3.1 of zophImport.pl I added +profile "*" to the calls to convert. (And in 0.3.3 I commented out this since for some users multiple thumbnails were being generated for an image. I did not see this problem, maybe it was a shell expansion issue. For most people it probably works so you may want to re-enable this feature.)</p>
<p>From <a href="http://www.imagemagick.org/www/convert.html" class="external free" title="http://www.imagemagick.org/www/convert.html" rel="nofollow">http://www.imagemagick.org/www/convert.html</a>:</p>
<p>"The '+profile "*"' removes any ICM, EXIF, IPTC, or other profiles that might be present in the input and aren't needed in the thumbnail."</p>
<p>This can result in a significant reduction in file sizes. If you do wish to preserve the profiles, remove this argument to convert.</p>
<p>Also, if you wish to regenerate your thumbnails after this change to save space, you can run a command like this from your image directory:</p>
<pre>
&gt; find . -iname "*.jpg" -a -not -name "mid_*" -a -not -name "thumb_*" | xargs zophImport.pl --update --thumbnails
</pre>
<p><a name="ZophExport.pl" id="ZophExport.pl"></a></p>
<h2> <span class="mw-headline">ZophExport.pl</span></h2>
<p>Zoph is a dynamic sort of application tied closely to the database. But sometimes you want static html files of your photos to burn to a cd or whatnot. Zoph includes a perl script, zophExport.pl, that lets you easily create static galleries.</p>
<p>There are numerous programs whose focus is to generate these sorts of static photo albums. Though I included a very simple built-in static album generator, zophExport.pl is primarily intended to be used with other scripts. Currently two such programs are supported:</p>
<ul>
<li>album (<a href="http://marginalhacks.com/Hacks/album/" class="external free" title="http://marginalhacks.com/Hacks/album/" rel="nofollow">http://marginalhacks.com/Hacks/album/</a>)</li>
<li>BINS (<a href="http://bins.sautret.org/" class="external free" title="http://bins.sautret.org/" rel="nofollow">http://bins.sautret.org/</a>)</li>
</ul>
<p>Both of these are easy to use and provided customizable interfaces.</p>
<p>Before you run the exporter make sure you configure it to use your database settings and image directory as described in the install doc.</p>
<p><a name="A_Quick_Example" id="A_Quick_Example"></a></p>
<h3> <span class="mw-headline">A Quick Example</span></h3>
<p>Here is a command that creates an export for use with the album program:</p>
<pre>
&gt; zophExport.pl --dir "~/Winter Pics" --format album --category Snow
</pre>
<p>After the exporter finishes it's up to you to run album. zophExport.pl prints out an example command to run album which you can copy and run as is or update with your own options.</p>
<p>In this simple example all photos placed in the Snow category are exported. Within the "Winter Pics" directory zophExport.pl will have created a directory structure mirroring the album structure in Zoph for the selected photos.</p>
<p>There are only two required arguments: the directory to export to (--dir) which will be created if it does not exist, and the format of the export (--format) which currently must be either "zoph", "album" or "bins".</p>
<p><a name="Selecting_Photos" id="Selecting_Photos"></a></p>
<h3> <span class="mw-headline">Selecting Photos</span></h3>
<p>Fields to search by are specified in the same was as in zophImport.pl. For example, you can say</p>
<pre>
&gt; zophExport.pl --dir "~/My Album" --format album --album "Boston Trip" --photographer "Jason Geiger" --field rating=5
</pre>
<p>Only photos I took on my trip to Boston that I rated 5 or more would be exported. By default subalbums of an album are automatically included (so my "Duck Tour" subalbum is also exported). You can disable this by passing --nosubalbums. The same goes for categories (use --nosubcategories to disable). Most fields match using the equals operator. Two exceptions are rating (which defaults to &gt;=) and description (which defaults to like).</p>
<p>You can probably do most things you want by using this system, especially since you can run zophExport.pl multiple times with different parameters, and even edit the results by hand if you wish, before you run album or bins to generate the galleries.</p>
<p>But if you have a particularly complicated query you want to run you can just pass it in directly using the --sql argument. Your query must select * from the photos table, other than that it can be anything. If you pass a sql statement any other constraint arguments are ignored. Make sure to only pass select statements, the script does no checking to make sure you aren't deleting all your data</p>
<p>Here's a tip if you run a complicated search within Zoph and then want to export only those photos. After you get to the results page open up config.inc.php and set DEBUG to 2. Then reload the results page and you should see two sql queries at the top of the page. Copy the first (the count query) and replace "count(distinct ph.photo_id)" with "ph.*", append "order by ph.date asc, ph.time asc" and pass this to zophExport.pl using the --sql argument.</p>
<p><a name="Choosing_What_to_Display" id="Choosing_What_to_Display"></a></p>
<h3> <span class="mw-headline">Choosing What to Display</span></h3>
<p>By default zophExport.pl will export everything about your photos except the last modified time, the rating and the albums or categories in which the photo appears.</p>
<p>To prevent the display of a particular field, use the --noshowFIELD argument. For example: --noshowlocation or --noshowdescription. Passing --noshowexif prevents any exif info from being shown. (Note, however, that the BINS program extracts exif info on its own).</p>
<p>The exporter can translate field labels using the same language files that Zoph uses. Pass --lang /path/to/php/lang/file to enable this option.</p>
<p>By default the exporter creates directories to mirror the structure of the albums in which the exported photos appear. To disable this and have all the photos appear directly under the export dir use the --noalbumdirs flag.</p>
<p><a name="A_Simple_Export" id="A_Simple_Export"></a></p>
<h3> <span class="mw-headline">A Simple Export</span></h3>
<p>The exporter contains the ability to generate a very simple static gallery. To use the simple exporter, pass --format zoph to zophExport.pl.</p>
<p>There are two advantages to this format. The first is that it requires no additional software. The second is speed. The simple format is much much faster simply because it uses the thumbnails already generated by Zoph whereas album and BINS generate their own. Someone could probably alter album or BINS so that they could reuse the thumbnails.</p>
<p>There's not really any elegant way to change the appearance of the gallery generated by this exporter. To do so you probably would want to edit zophExport.pl. It wouldn't be too difficult to add css support but I didn't. I only wanted to spend so much time reinventing the wheel.</p>
<p><a name="Exporting_to_Album" id="Exporting_to_Album"></a></p>
<h3> <span class="mw-headline">Exporting to Album</span></h3>
<p>album is written by David Ljung Madison. <a href="http://marginalhacks.com/Hacks/album/" class="external free" title="http://marginalhacks.com/Hacks/album/" rel="nofollow">http://marginalhacks.com/Hacks/album/</a></p>
<p>album is a single perl script which requires nothing more than you already have from using Zoph (ImageMagick and Image::Size). A debian package is available.</p>
<p>To use album, specify --format album to zophExport.pl. The exporter will create a captions.txt file in each directory that contains images.</p>
<p>Album is themeable and a number of themes are available from the website. I'd recommend you download a different theme, or create your own, simply because the default theme displays all of the info about a photo on the thumbnails page which can be quite a bit if you include descriptions and exif data. You specify a theme by passing -theme /path/to/theme/dir to album.</p>
<p><a name="Exporting_to_BINS" id="Exporting_to_BINS"></a></p>
<h3> <span class="mw-headline">Exporting to BINS</span></h3>
<p>BINS is written by Jerome Sautret, based on SWIGS, written by Brendan McMahan, which was in turn based on IDS by John Moose. <a href="http://bins.sautret.org/" class="external free" title="http://bins.sautret.org/" rel="nofollow">http://bins.sautret.org/</a></p>
<p>BINS consists of three perl scripts: an exporter and two image/album description editors. A debian package is available. BINS requires a number of perl modules which you can get from CPAN if you need to.</p>
<p>To use BINS, specify --format bins to zophExport.pl. The exporter will create an image.jpg.xml file for each photo and an album.xml file in each directory.</p>
<p>BINS takes a source directory and a target directory. zophExport.pl will create the target directory based on the --dir you specify. It will also append ".tmp" to the target directory name and create another directory to which it will copy the images from Zoph and which will act as the source dir for BINS. You can remove this temp dir after BINS finishes. You can set the source and target directory to the same dir in BINS but you can only run BINS against that directory once, after that it will start creating thumbnails of the thumbnails, etc.</p>
<p>You can create a config xml file for BINS to use. I found it useful to set the defaultSize parameter to 0 (default to small images).</p>


<!-- 
NewPP limit report
Preprocessor node count: 17/1000000
Post-expand include size: 0/2048000 bytes
Template argument size: 0/2048000 bytes
Expensive parser function count: 0/500
-->

</div>
</html>
